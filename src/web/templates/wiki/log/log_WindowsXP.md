![logo](/static/images/logo.png)

##  Настройка ОС Windows  
> Описание процесса настройки ОС Windows для отправки сообщений в ZIEM  
> Область применения:  
> -- Windows XP  
> -- Windows Server 2003

## Содержание  
[Описание](#info)  
[Настройка Пользователя](#user)  
[Настройка WMI](#wmi)  
[Настройка DCOM](#dcom)  
[Настройка Брандмауера](#fw)  
[Настройка Политики аудита](#audit)  
[Настройка Сети](#net)  

<a name="info"/>  

## Описание  
</a>  

> Получения журналов Windows происходит при помощи WMI  
> WMI в свою очередь использует протокол DCOM  
> На источнике необходимо создать `пользователя` для подключения  
> Предоставить ему `права` и настроить `Брандмауэр`  
> Также для генерации сообщений необходимо настроить `аудит`
> Необходимо перезагрузить АРМ в конце настройки  

<hr class="pagebreak">

<a name="user"/>  

## Настройка Пользователя  
</a>  

- Создаeм пользователя 
```cmd
net user /add ziem_user * (при использовании скрипта делать не надо)
```
- Делаем учетную запись технологической, без интерактивного входа  
-- запускаем `secpol.msc`  
-- выбираем `Локальные политики / Назначение прав пользователя`  
-- добавляем `ziem_user` в следующие списки  
*Запретить вход в систему через службу терминалов*  
*Вход в качестве службы*  
*Доступ к компьютеру из сети*  

<a name="dcom"/>  

## Настройка DCOM  
</a>  

- Запускаем `dcomcnfg`  
- Правый-щелчок `Службы компонентов \ Компьютеры \ Мой компьютер`, выбираем `свойства`   
- Выбираем вкладку `Безопасность COM`  
- В поле `Права доступа` нажимаем `Изменить ограничения`  
- Добавляем пользователя `ziem_user` c `разрешениями`  
-- *Удаленный доступ*  
- В поле `Разрешения на запуск и активацию` нажимаем `Изменить ограничения`  
- Добавляем пользователя `ziem_user` c `разрешениями`  
-- *Удаленный запуск, Удаленная активация*  
- Правый-щелчок `Службы компонентов \ Компьютеры \ Мой компьютер \ Настройка DCOM \ Windows Management and Instrumentation`, выбираем `свойства`   
- Выбираем вкладку `Безопасность`  
- В поле `Разрешения на запуск` нажимаем `Настроить \ Изменить`  
- Добавляем пользователя `ziem_user` c `разрешениями`  
-- *Удаленный запуск, Удаленная активация*  
- В поле `Разрешение на доступ` нажимаем `Настроить \ Изменить`  
- Добавляем пользователя `ziem_user` c `разрешениями`  
-- *Удаленный доступ*  

<a name="wmi"/>  

## Настройка WMI  
</a>  

- Запускаем `wmimgmt.msc`  
- Правый-щелчок `Элемент управления WMI`, выбираем `свойства`  
- Вкладка `Безопасность`  
- Выбираем `CIMV2`, нажимаем `Безопасность`  
- Нажимаем `добавить`  
- Добавляем пользователя `ziem_user` c `разрешениями`  
-- *Выполнение методов, Включить учетную запись, Включить удаленно, Прочесть безопасность*  

<a name="fw"/>  

## Настройка Брандмауера  
</a>  

- Добавляем правила для WMI (при использовании скрипта делать не надо)
```cmd
netsh firewall add portopening TCP 135 ZIEM-RPC-135
netsh firewall add portopening TCP 49152-65535 ZIEM-RPC-Dynamic
```

<a name="audit"/>  

## Настройка политики аудита  
</a>  

- Запускаем `secpol.msc`
- Выбираем раздел `Локальные политики \ Политика аудита`  
- Настраиваем параметры 
 
    -- Аудит входа в систему `Успех отказ`  
    -- Аудит изменения политики `Успех`  
    -- Аудит отслеживания процессов `Успех`  
    -- Аудит системных событий `Успех`  
    -- Аудит управления учетными записями `Успех отказ`  

<a name="net"/>  

## Настройка сети  
</a>  

- При необходимости создать маршруты для доступа к ZIEM

